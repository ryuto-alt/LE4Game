# LE4Game - DirectX 12ゲームエンジン

## プロジェクト概要

DirectX 12を使用して開発された3Dゲームエンジンです。PBR（Physically Based Rendering）レンダリング、スケルタルアニメーション、物理演算、空間オーディオなどの高度な機能を実装しています。就職作品として、エンジン設計からゲームロジックまでを一貫して開発しました。

### 開発環境
- **言語**: C++17
- **グラフィックスAPI**: DirectX 12
- **開発環境**: Visual Studio 2022
- **ビルド構成**: Debug/Release/Profile (x64)

---

## 主要機能

### 1. グラフィックスシステム

#### PBRレンダリング
- **Physically Based Rendering**を実装
- メタリック/ラフネスワークフロー対応
- 環境マッピング（IBL - Image Based Lighting）対応
- ディレクショナルライト、スポットライトのサポート

#### スケルタルアニメーション
- GLTF形式のスキンメッシュ対応
- アニメーションブレンディング機能
- 複数アニメーション間のスムーズな遷移
- アニメーションプレイヤーによる再生制御（再生/停止/一時停止/ループ）

#### シェーダーシステム
実装されているシェーダー:
- `PBRObject3d.VS/PS.hlsl` - PBRマテリアルレンダリング
- `PBRSkinningObject3d.VS.hlsl` - スキニングアニメーション対応
- `Skybox.VS/PS.hlsl` - 環境スカイボックス
- `Particle.VS/PS.hlsl` - パーティクルエフェクト
- `Horror.PS.hlsl`/`HorrorOverlay.PS.hlsl` - ポストプロセスエフェクト

#### モデルローディング
- **GLTF 2.0形式**対応（TinyGLTFライブラリ使用）
- **Assimp**による多様な3Dフォーマットサポート
- テクスチャ読み込み（DirectXTexライブラリ）

### 2. アニメーションシステム

#### AnimationPlayer
- アニメーションの再生制御
- ループ再生、ワンショット再生対応
- アニメーション時間の制御

#### AnimationBlender
- 複数アニメーション間のブレンディング
- スムーズなアニメーション遷移
- ブレンド進捗の管理

#### AnimatedModel
- スケルタル構造の管理
- ボーン行列の計算
- アニメーションデータの保持

### 3. カメラシステム

#### FPSカメラ
- **一人称視点カメラ**の実装
- マウスルック機能（視点回転）
- キーボード/ゲームパッドによる移動
- 視点の滑らかな補間

#### 三人称カメラ
- プレイヤー追従カメラ
- オービットカメラ機能
- カメラ距離・高さの調整

### 4. 入力システム

- **キーボード入力**（DirectInput）
- **マウス入力**（相対移動、クリック検出）
- **Xboxコントローラー**対応
  - アナログスティック（デッドゾーン処理）
  - トリガー入力
  - ボタン入力（押下/トリガー判定）

### 5. オーディオシステム

#### AudioManager
- WAVファイル、MP3ファイル再生対応
- ボリューム制御
- 再生/停止/一時停止機能

#### 空間オーディオ
- **SpatialAudioSource** - 3D音源配置
- **SpatialAudioListener** - リスナー位置・向きの管理
- 距離減衰の自動計算
- 3D空間での音響シミュレーション

### 6. パーティクルシステム

#### 2Dパーティクル
- `ParticleManager` - 2Dパーティクル管理
- `ParticleEmitter` - エミッター制御

#### 3Dパーティクル
- `Particle3DManager` - 3Dパーティクル管理
- `Particle3DEmitter` - 3D空間でのパーティクル放出
- `HitEffect3D` - ヒットエフェクト
- `EffectManager3D` - エフェクト統合管理

### 7. 衝突判定システム

#### AABBCollision
- **AABB（Axis-Aligned Bounding Box）**による衝突判定
- `AABBCollisionManager` - 衝突オブジェクトの一括管理
- `AABBExtractor` - モデルから自動的にAABBを抽出
- 静的/動的オブジェクトの登録
- 衝突応答処理

### 8. シーン管理システム

#### SceneManager
- シーン遷移システム
- シーンファクトリーパターンによる生成

#### 実装シーン
- **LogoScene** - ロゴ表示シーン
- **TitleScene** - タイトルシーン
- **GamePlayScene** - ゲームプレイシーン

### 9. ゲームオブジェクト

#### Player
- プレイヤーキャラクターの制御
- 移動処理（前後左右、走行、スニーク）
- ジャンプ機能
- 重力処理
- カメラ連動
- アニメーション制御（待機、歩行、走行、スニーク）
- コリジョン応答
- ゲームパッド対応

#### Ground
- 地面オブジェクト
- 静的コリジョン

#### Enemy
- 敵キャラクター

---

## アーキテクチャ設計

### エンジンコア (UnoEngine)

**UnoEngine**はシングルトンパターンで実装されたエンジンコアで、以下の機能を提供します：

#### 初期化・更新・描画の統合管理
```cpp
UnoEngine* engine = UnoEngine::GetInstance();
engine->Initialize();
engine->Run();  // ゲームループ
UnoEngine::DestroyInstance();
```

#### サブシステムへの統一アクセス
- DirectXCommon（グラフィックスデバイス管理）
- Input（入力管理）
- Camera（カメラ管理）
- AudioManager（音声管理）
- TextureManager（テクスチャ管理）
- SRVManager（シェーダーリソース管理）
- AABBCollisionManager（衝突判定管理）

#### リソース生成API
```cpp
// オブジェクト生成
auto object = engine->CreateObject3D();
auto sprite = engine->CreateSprite();
auto skybox = engine->CreateSkybox();

// モデル/アニメーション読み込み
auto model = engine->CreateAnimatedModel();
model->LoadFromFile("path/to/model", "model.gltf");

// オーディオ
engine->LoadAudio("bgm.wav");
engine->PlayAudio("bgm.wav", true); // ループ再生
```

### レンダリングパイプライン

#### DirectXCommon
- デバイス初期化
- スワップチェーン管理
- コマンドキューとコマンドリスト管理
- 深度ステンシルバッファ
- 背景色設定

#### SRVManager
- シェーダーリソースビューの一括管理
- ディスクリプタヒープ管理
- テクスチャバインディング

#### Object3D
- 3Dオブジェクトの描画
- トランスフォーム（座標、回転、スケール）
- カメラ設定
- ライティング有効/無効
- 環境マップ設定
- アニメーション制御
- コリジョン有効化

### フレームワークパターン

**Framework**クラスを基底として、ゲームループを実装：
```cpp
class MyGame : public Framework {
    void Initialize() override;
    void Update() override;
    void Draw() override;
    void Finalize() override;
};
```

### デルタタイム管理

フレームレート非依存の動作を実現：
```cpp
float deltaTime = engine->GetDeltaTime();
position += velocity * deltaTime;
```

---

## プロジェクト構造

```
LE4Game/
├── src/
│   ├── Engine/                      # エンジンコア
│   │   ├── UnoEngine.h/cpp          # エンジンメインクラス
│   │   ├── Animation/               # アニメーションシステム
│   │   │   ├── AnimatedModel.h/cpp
│   │   │   ├── AnimationPlayer.h/cpp
│   │   │   ├── AnimationBlender.h/cpp
│   │   │   └── AnimationUtility.h/cpp
│   │   ├── Audio/                   # オーディオシステム
│   │   │   ├── AudioManager.h/cpp
│   │   │   ├── AudioSource.h/cpp
│   │   │   ├── SpatialAudioSource.h/cpp
│   │   │   ├── SpatialAudioListener.h/cpp
│   │   │   ├── WaveFile.h/cpp
│   │   │   └── Mp3File.h/cpp
│   │   ├── Camera/                  # カメラシステム
│   │   │   └── Camera.h/cpp
│   │   ├── Collision/               # 衝突判定
│   │   │   ├── AABBCollision.h/cpp
│   │   │   └── CollisionPrimitive.h
│   │   ├── Core/                    # コアシステム
│   │   │   ├── Framework.h/cpp
│   │   │   └── Scene.h
│   │   ├── Graphics/                # グラフィックス
│   │   │   ├── DirectXCommon.h/cpp
│   │   │   ├── Model.h/cpp
│   │   │   ├── Object3d.h/cpp
│   │   │   ├── Sprite.h/cpp
│   │   │   ├── SpriteCommon.h/cpp
│   │   │   ├── Skybox.h/cpp
│   │   │   ├── TextureManager.h/cpp
│   │   │   ├── SRVManager.h/cpp
│   │   │   ├── TinyGLTFLoader.h/cpp
│   │   │   ├── RenderingPipeline.h/cpp
│   │   │   ├── PostProcess.h/cpp
│   │   │   └── VideoPlayer.h/cpp
│   │   ├── Input/                   # 入力管理
│   │   │   └── Input.h/cpp
│   │   ├── Math/                    # 数学ライブラリ
│   │   │   └── Mymath.h/cpp
│   │   ├── Particle/                # パーティクルシステム
│   │   │   ├── ParticleManager.h/cpp
│   │   │   ├── ParticleEmitter.h
│   │   │   ├── Particle3DManager.h/cpp
│   │   │   ├── Particle3DEmitter.h/cpp
│   │   │   ├── HitEffect3D.h/cpp
│   │   │   └── EffectManager3D.h/cpp
│   │   ├── Resource/                # リソース管理
│   │   │   └── ResourcePreloader.h/cpp
│   │   └── Utility/                 # ユーティリティ
│   │       ├── WinApp.h/cpp
│   │       ├── Logger.h/cpp
│   │       └── StringUtility.h/cpp
│   └── Game/                        # ゲームロジック
│       ├── main.cpp                 # エントリーポイント
│       ├── Core/
│       │   └── MyGame.h/cpp         # ゲームメインクラス
│       ├── GameObject/              # ゲームオブジェクト
│       │   ├── Player.h/cpp
│       │   ├── Enemy.h/cpp
│       │   ├── Ground.h/cpp
│       │   └── FPSCamera.h/cpp
│       ├── Manager/                 # 各種マネージャー
│       │   └── LightManager.h/cpp
│       └── scene/                   # シーン
│           ├── IScene.h
│           ├── SceneManager.h/cpp
│           ├── LogoScene.h/cpp
│           ├── TitleScene.h/cpp
│           └── GamePlayScene.h/cpp
├── Resources/                       # リソースファイル
│   ├── Models/                      # 3Dモデル（GLTF, OBJ）
│   ├── shaders/                     # HLSLシェーダー
│   └── textures/                    # テクスチャ
├── externals/                       # 外部ライブラリ
│   ├── DirectXTex/                  # テクスチャ処理
│   ├── imgui/                       # デバッグUI
│   ├── assimp/                      # 3Dモデル読み込み
│   ├── tinygltf/                    # GLTF読み込み
│   └── bullet3/                     # 物理演算（予定）
└── CG2_00-01.sln                    # Visual Studioソリューション
```

---

## 技術的特徴

### 1. DirectX 12の低レベル制御
- コマンドリスト、コマンドキューの直接管理
- ディスクリプタヒープの効率的な使用
- ルートシグネチャの設計
- パイプラインステートオブジェクトの管理

### 2. PBRレンダリングの実装
- Cook-Torrance BRDFモデル
- フレネル反射（Schlickの近似）
- GGX法線分布関数
- IBL（Image-Based Lighting）による環境反射

### 3. データ駆動設計
- GLTF形式による標準化されたアセットパイプライン
- JSONによるシーン記述
- リソースプリローディング機能

### 4. メモリ管理
- スマートポインタ（`std::unique_ptr`, `std::shared_ptr`）の活用
- リソースリークチェック機能（`D3DResourceLeakChecker`）

### 5. エラーハンドリング
- 例外処理によるエラー伝播
- デバッグビルドでの詳細ログ出力（`Logger`クラス）

---

## ビルド方法

### 前提条件
- Windows 10/11
- Visual Studio 2022
- Windows SDK 10.0以上
- DirectX 12対応GPU

### ビルド手順
1. `CG2_00-01.sln`をVisual Studio 2022で開く
2. 構成を選択（Debug/Release）
3. プラットフォームを`x64`に設定
4. ビルド実行（Ctrl+Shift+B）

### 実行
- デバッグ実行: F5
- 実行ファイル: `x64/Debug/CG2_00-01.exe` または `x64/Release/CG2_00-01.exe`

---

## 今後の拡張予定

### 物理演算
- Bullet Physicsライブラリの統合
- リジッドボディシミュレーション
- 物理マテリアル（摩擦、反発）

### レンダリング拡張
- シャドウマッピング（カスケードシャドウマップ）
- SSAO（Screen Space Ambient Occlusion）
- HDRレンダリング＋トーンマッピング
- ブルーム、被写界深度などのポストエフェクト

### UI/UXシステム
- ImGuiベースのインゲームUI
- HUDシステム
- メニューシステム

---

## 使用ライブラリ

| ライブラリ | 用途 | バージョン |
|-----------|------|-----------|
| DirectXTex | テクスチャ読み込み・変換 | 最新版 |
| ImGui | デバッグUI | 最新版 |
| Assimp | 3Dモデル読み込み | 5.x |
| TinyGLTF | GLTF形式サポート | 最新版 |
| DirectInput | キーボード・マウス入力 | DirectX SDK |
| XInput | Xboxコントローラー | Windows SDK |

---

## 作者

**プロジェクト名**: LE4Game
**目的**: 就職作品ポートフォリオ
**開発期間**: [開発開始時期] 〜 現在

---

## ライセンス

本プロジェクトは就職作品として開発されたものです。使用している外部ライブラリはそれぞれのライセンスに従います。

---

## デモシーン（GamePlayScene）の実装例

```cpp
void GamePlayScene::Initialize() {
    UnoEngine* engine = UnoEngine::GetInstance();

    // ライト管理
    lightManager_ = std::make_unique<LightManager>();
    lightManager_->Initialize();

    // FPSカメラ
    fpsCamera_ = std::make_unique<FPSCamera>();
    fpsCamera_->Initialize(true); // 一人称モード

    // プレイヤー
    player_ = std::make_unique<Player>();
    player_->Initialize(camera_, true, true); // コリジョン有効、環境マップ有効
    player_->SetupCamera(engine);

    // 地面モデル
    groundModel_ = engine->CreateAnimatedModel();
    groundModel_->LoadFromFile("Resources/Models/ground", "ground.gltf");

    ground_ = engine->CreateObject3D();
    ground_->SetModel(static_cast<Model*>(groundModel_.get()));
    ground_->EnableEnv(true); // 環境マップ有効
    ground_->SetEnableLighting(true);

    // AABB衝突判定登録
    auto* collisionManager = Collision::AABBCollisionManager::GetInstance();
    Collision::AABB groundAABB = Collision::AABBExtractor::ExtractFromAnimatedModel(groundModel_.get());
    collisionManager->RegisterObject(ground_.get(), groundAABB, true, "Ground");
}

void GamePlayScene::Update() {
    UnoEngine* engine = UnoEngine::GetInstance();

    player_->HandleInput(engine);

    if (fpsCamera_ && fpsCamera_->IsFPSMode()) {
        fpsCamera_->UpdateCameraRotation(camera_, engine);
        player_->UpdateFPSCamera(fpsCamera_.get());
        camera_->Update();
    } else {
        player_->UpdateCameraSystem(engine);
    }

    lightManager_->Update();
    player_->Update();
}
```

---


